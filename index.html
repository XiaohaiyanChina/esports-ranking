<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LDTV CSGO排行榜</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root {
            --primary-color: #2ecc71;
            --primary-dark: #27ae60;
            --primary-light: #48c774;
            --secondary-color: #3498db;
            --dark-color: #2c3e50;
            --darker-color: #1a252f;
            --light-color: #ecf0f1;
            --gray-color: #7f8c8d;
            --light-gray: #bdc3c7;
            --white-color: #ffffff;
            --danger-color: #e74c3c;
            --danger-dark: #c0392b;
            --warning-color: #f39c12;
            --warning-dark: #e67e22;
            --info-color: #3498db;
            --success-color: #2ecc71;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            --shadow-heavy: 0 8px 24px rgba(0, 0, 0, 0.15);
            --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            --border-radius: 8px;
            --border-radius-sm: 4px;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif; background: linear-gradient(135deg, #f5f7fa 0%, #e4e8eb 100%); color: #333; line-height: 1.6; min-height: 100vh; }
        .navbar { background-color: var(--darker-color); color: var(--white-color); padding: 0 20px; box-shadow: var(--shadow-heavy); position: sticky; top: 0; z-index: 1000; height: 70px; display: flex; align-items: center; }
        .nav-container { display: flex; justify-content: space-between; align-items: center; width: 100%; max-width: 1400px; margin: 0 auto; }
        .logo { display: flex; align-items: center; font-size: 1.8rem; font-weight: 800; color: var(--primary-color); text-decoration: none; transition: var(--transition); }
        .logo:hover { transform: translateY(-2px); }
        .logo i { margin-right: 12px; font-size: 2rem; }
        .nav-menu { display: flex; list-style: none; gap: 5px; }
        .nav-item { position: relative; }
        .nav-link { color: var(--white-color); text-decoration: none; padding: 10px 20px; border-radius: 30px; transition: var(--transition); font-weight: 600; display: flex; align-items: center; gap: 8px; font-size: 0.95rem; }
        .nav-link:hover { background-color: rgba(255, 255, 255, 0.1); transform: translateY(-2px); }
        .nav-link.active { background-color: var(--primary-color); color: var(--white-color); box-shadow: 0 4px 12px rgba(46, 204, 113, 0.3); }
        .container { max-width: 1400px; margin: 30px auto; padding: 0 20px; }
        .page-title { margin-bottom: 30px; color: var(--dark-color); padding-bottom: 15px; border-bottom: 3px solid var(--primary-color); display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px; }
        .page-title h2 { font-size: 2rem; font-weight: 700; display: flex; align-items: center; gap: 12px; }
        .page-title h2 i { color: var(--primary-color); }
        .page-subtitle { color: var(--gray-color); font-size: 1rem; font-weight: 500; }
        .page { display: none; }
        .page.active { display: block; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .btn { padding: 12px 24px; border: none; border-radius: 30px; cursor: pointer; font-weight: 600; transition: var(--transition); display: inline-flex; align-items: center; justify-content: center; gap: 8px; font-size: 0.95rem; letter-spacing: 0.3px; text-decoration: none; }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1); }
        .btn:active { transform: translateY(0); }
        .btn-primary { background: linear-gradient(135deg, var(--primary-color), var(--primary-dark)); color: var(--white-color); }
        .btn-primary:hover { background: linear-gradient(135deg, var(--primary-light), var(--primary-color)); box-shadow: 0 6px 15px rgba(46, 204, 113, 0.3); }
        .btn-secondary { background-color: var(--light-color); color: var(--dark-color); }
        .btn-secondary:hover { background-color: #d5dbdb; }
        .btn-danger { background: linear-gradient(135deg, var(--danger-color), var(--danger-dark)); color: var(--white-color); }
        .btn-danger:hover { background: linear-gradient(135deg, #ff6b6b, var(--danger-color)); box-shadow: 0 6px 15px rgba(231, 76, 60, 0.3); }
        .btn-sm { padding: 8px 16px; font-size: 0.85rem; }
        .card { background-color: var(--white-color); border-radius: var(--border-radius); box-shadow: var(--shadow); padding: 25px; margin-bottom: 25px; transition: var(--transition); border: 1px solid rgba(0, 0, 0, 0.05); }
        .card:hover { box-shadow: var(--shadow-heavy); transform: translateY(-5px); }
        .match-card { background: linear-gradient(135deg, var(--white-color) 0%, #f8f9fa 100%); border-left: 4px solid var(--primary-color); }
        .match-time { color: var(--gray-color); font-size: 0.9rem; }
        .match-teams { display: flex; align-items: center; justify-content: center; gap: 30px; margin: 20px 0; }
        .match-team { display: flex; flex-direction: column; align-items: center; gap: 10px; }
        .match-team-logo { width: 60px; height: 60px; border-radius: 50%; object-fit: cover; border: 3px solid var(--light-color); box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1); }
        .match-team-name { font-weight: 600; color: var(--dark-color); font-size: 1.1rem; }
        .match-vs { font-size: 1.5rem; font-weight: 700; color: var(--primary-color); }
        .match-score { font-size: 2.5rem; font-weight: 800; color: var(--dark-color); margin: 0 15px; }
        .team-table { width: 100%; }
        .team-row { display: flex; align-items: center; padding: 20px 25px; border-bottom: 1px solid var(--light-color); transition: var(--transition); cursor: pointer; background: var(--white-color); }
        .team-row:first-child { border-top-left-radius: var(--border-radius); border-top-right-radius: var(--border-radius); }
        .team-row:last-child { border-bottom-left-radius: var(--border-radius); border-bottom-right-radius: var(--border-radius); border-bottom: none; }
        .team-row:hover { background: rgba(46, 204, 113, 0.05); transform: translateX(5px); }
        .team-rank { background: linear-gradient(135deg, var(--primary-color), var(--primary-dark)); color: var(--white-color); width: 45px; height: 45px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 1.2rem; margin-right: 20px; flex-shrink: 0; }
        .team-row .team-rank.gold { background: linear-gradient(135deg, #f1c40f, #f39c12); }
        .team-row .team-rank.silver { background: linear-gradient(135deg, #bdc3c7, #95a5a6); }
        .team-row .team-rank.bronze { background: linear-gradient(135deg, #e67e22, #d35400); }
        .team-row .team-logo { width: 60px; height: 60px; border-radius: 50%; object-fit: cover; margin-right: 20px; border: 3px solid var(--light-color); flex-shrink: 0; }
        .team-row .team-info { flex: 1; }
        .team-row .team-info h3 { font-size: 1.3rem; font-weight: 700; color: var(--dark-color); margin-bottom: 5px; }
        .team-row .team-coach { color: var(--gray-color); font-size: 0.9rem; }
        .team-row .team-players { display: flex; gap: 8px; margin-left: auto; flex-shrink: 0; }
        .team-row .player-chip { display: flex; align-items: center; gap: 6px; background: var(--light-color); padding: 6px 12px; border-radius: 20px; cursor: pointer; transition: var(--transition); font-size: 0.85rem; }
        .team-row .player-chip:hover { background: var(--primary-color); color: var(--white-color); transform: translateY(-2px); }
        .team-row .player-chip img { width: 24px; height: 24px; border-radius: 50%; object-fit: cover; }
        .team-row .team-points { background: linear-gradient(135deg, var(--warning-color), var(--warning-dark)); color: var(--white-color); padding: 10px 20px; border-radius: 25px; font-weight: 700; font-size: 1rem; margin-left: 20px; flex-shrink: 0; }
        .player-table { width: 100%; }
        .player-row { display: flex; align-items: center; padding: 15px; border-bottom: 1px solid var(--light-color); transition: var(--transition); cursor: pointer; }
        .player-row:hover { background-color: rgba(46, 204, 113, 0.05); transform: translateX(5px); }
        .player-rank { font-size: 1.2rem; font-weight: 700; color: var(--primary-color); width: 40px; }
        .player-avatar { width: 50px; height: 50px; border-radius: 50%; object-fit: cover; margin-right: 15px; border: 3px solid var(--light-color); }
        .player-info { flex: 1; }
        .player-name { font-weight: 600; color: var(--dark-color); font-size: 1.1rem; }
        .player-team { color: var(--gray-color); font-size: 0.9rem; }
        .player-rating { background: linear-gradient(135deg, var(--primary-color), var(--primary-dark)); color: var(--white-color); padding: 8px 16px; border-radius: 20px; font-weight: 700; font-size: 1.1rem; }
        .tabs { display: flex; gap: 5px; margin-bottom: 25px; background: var(--white-color); padding: 8px; border-radius: var(--border-radius); box-shadow: var(--shadow); }
        .tab { padding: 12px 24px; cursor: pointer; background: none; border: none; font-weight: 600; color: var(--gray-color); border-radius: var(--border-radius); transition: var(--transition); }
        .tab:hover { color: var(--primary-color); background: rgba(46, 204, 113, 0.1); }
        .tab.active { background: var(--primary-color); color: var(--white-color); }
        .tab-pane { display: none; }
        .tab-pane.active { display: block; animation: fadeIn 0.3s ease; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 600; color: var(--dark-color); }
        .form-control { width: 100%; padding: 12px 16px; border: 2px solid var(--light-color); border-radius: var(--border-radius); font-size: 1rem; transition: var(--transition); }
        .form-control:focus { outline: none; border-color: var(--primary-color); box-shadow: 0 0 0 3px rgba(46, 204, 113, 0.1); }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); z-index: 2000; align-items: center; justify-content: center; }
        .modal.active { display: flex; }
        .modal-content { background: var(--white-color); border-radius: var(--border-radius); max-width: 800px; width: 90%; max-height: 90vh; overflow-y: auto; box-shadow: var(--shadow-heavy); }
        .modal-header { padding: 20px 25px; border-bottom: 2px solid var(--light-color); display: flex; justify-content: space-between; align-items: center; }
        .modal-header h2 { font-size: 1.5rem; color: var(--dark-color); }
        .modal-close { background: none; border: none; font-size: 1.5rem; cursor: pointer; color: var(--gray-color); transition: var(--transition); }
        .modal-close:hover { color: var(--danger-color); transform: rotate(90deg); }
        .modal-body { padding: 25px; }
        .modal-footer { padding: 20px 25px; border-top: 2px solid var(--light-color); display: flex; justify-content: flex-end; gap: 10px; }
        .team-detail-header { display: flex; align-items: center; gap: 30px; margin-bottom: 30px; padding: 30px; background: linear-gradient(135deg, var(--primary-color), var(--primary-dark)); border-radius: var(--border-radius); color: var(--white-color); }
        .team-detail-logo { width: 120px; height: 120px; border-radius: 50%; object-fit: cover; border: 5px solid rgba(255, 255, 255, 0.3); }
        .team-detail-info h1 { font-size: 2.5rem; margin-bottom: 10px; }
        .team-detail-info p { opacity: 0.9; font-size: 1.1rem; }
        .back-btn { background: rgba(255, 255, 255, 0.2); color: var(--white-color); border: none; padding: 10px 20px; border-radius: 30px; cursor: pointer; display: flex; align-items: center; gap: 8px; font-weight: 600; transition: var(--transition); margin-left: auto; }
        .back-btn:hover { background: rgba(255, 255, 255, 0.3); transform: translateY(-2px); }
        .player-detail-header { display: flex; gap: 30px; padding: 30px; background: linear-gradient(135deg, var(--primary-color), var(--primary-dark)); border-radius: var(--border-radius); color: var(--white-color); margin-bottom: 30px; }
        .player-detail-avatar { width: 150px; height: 150px; border-radius: 50%; object-fit: cover; border: 5px solid rgba(255, 255, 255, 0.3); }
        .player-detail-info h1 { font-size: 2rem; margin-bottom: 10px; }
        .player-detail-info p { opacity: 0.9; margin-bottom: 5px; }
        .player-stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 20px; margin-top: 20px; }
        .stat-box { background: rgba(255, 255, 255, 0.2); padding: 15px; border-radius: 10px; text-align: center; }
        .stat-value { font-size: 1.8rem; font-weight: 700; }
        .stat-label { font-size: 0.9rem; opacity: 0.9; }
        .comparison-container { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-top: 30px; }
        .comparison-player { background: var(--white-color); border-radius: var(--border-radius); padding: 25px; box-shadow: var(--shadow); }
        .comparison-player h3 { margin-bottom: 20px; color: var(--dark-color); display: flex; align-items: center; gap: 10px; }
        .comparison-player select { width: 100%; padding: 10px; border: 2px solid var(--light-color); border-radius: var(--border-radius); margin-bottom: 20px; }
        .chart-container { position: relative; height: 300px; }
        .admin-login { max-width: 400px; margin: 100px auto; text-align: center; }
        .admin-login .card { padding: 40px; }
        .input-group { position: relative; margin-bottom: 20px; }
        .input-group input { width: 100%; padding: 15px 20px; padding-left: 50px; border: 2px solid var(--light-color); border-radius: 30px; font-size: 1rem; transition: var(--transition); }
        .input-group i { position: absolute; left: 20px; top: 50%; transform: translateY(-50%); color: var(--gray-color); }
        .input-group input:focus { outline: none; border-color: var(--primary-color); }
        .data-table { width: 100%; border-collapse: collapse; background: var(--white-color); border-radius: var(--border-radius); overflow: hidden; box-shadow: var(--shadow); }
        .data-table th, .data-table td { padding: 15px 20px; text-align: left; border-bottom: 1px solid var(--light-color); }
        .data-table th { background: linear-gradient(135deg, var(--primary-color), var(--primary-dark)); color: var(--white-color); font-weight: 600; }
        .data-table tr:hover { background: rgba(46, 204, 113, 0.05); }
        .data-table img { width: 40px; height: 40px; border-radius: 50%; object-fit: cover; margin-right: 10px; vertical-align: middle; }
        .action-btns { display: flex; gap: 8px; }
        .action-btn { padding: 8px 12px; border: none; border-radius: 8px; cursor: pointer; transition: var(--transition); }
        .action-btn.edit { background: var(--info-color); color: var(--white-color); }
        .action-btn.delete { background: var(--danger-color); color: var(--white-color); }
        .action-btn:hover { transform: translateY(-2px); box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1); }
        .stats-grid { display: grid; grid-template-columns: repeat(6, 1fr); gap: 15px; margin-top: 20px; }
        .stat-item { text-align: center; }
        .stat-item label { display: block; margin-bottom: 8px; font-size: 0.9rem; color: var(--gray-color); }
        .stat-item input { width: 100%; padding: 10px; border: 2px solid var(--light-color); border-radius: var(--border-radius); text-align: center; font-weight: 600; }
        .stat-item input:focus { outline: none; border-color: var(--primary-color); }
        .stats-radar-container { position: relative; height: 350px; margin: 30px 0; }
        .achievement-list { list-style: none; }
        .achievement-list li { padding: 10px 15px; background: var(--light-color); border-radius: var(--border-radius); margin-bottom: 10px; display: flex; align-items: center; gap: 10px; }
        .achievement-list li i { color: var(--warning-color); }
        .no-data { text-align: center; padding: 60px 20px; color: var(--gray-color); }
        .no-data i { font-size: 4rem; margin-bottom: 20px; opacity: 0.5; }
        .no-data h3 { margin-bottom: 10px; color: var(--dark-color); }
        .loading-spinner { display: inline-block; width: 40px; height: 40px; border: 3px solid var(--light-color); border-radius: 50%; border-top-color: var(--primary-color); animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .loading-container { display: flex; justify-content: center; align-items: center; padding: 60px 20px; }
        .alert { padding: 15px 20px; border-radius: var(--border-radius); margin-bottom: 20px; }
        .alert-info { background: #e8f4f8; border-left: 4px solid #3498db; color: #2980b9; }
        .alert-success { background: #e8f8f5; border-left: 4px solid #2ecc71; color: #27ae60; }
        .alert-warning { background: #fef9e7; border-left: 4px solid #f39c12; color: #d68910; }
        .alert-danger { background: #fdedec; border-left: 4px solid #e74c3c; color: #c0392b; }
        @media (max-width: 768px) { .nav-menu { display: none; position: absolute; top: 70px; left: 0; right: 0; background: var(--darker-color); flex-direction: column; padding: 20px; gap: 10px; } .nav-menu.active { display: flex; } .hamburger { display: block; font-size: 1.5rem; cursor: pointer; color: var(--white-color); } .team-detail-header { flex-direction: column; text-align: center; } .back-btn { margin-left: 0; margin-top: 20px; } .player-detail-header { flex-direction: column; align-items: center; text-align: center; } .comparison-container { grid-template-columns: 1fr; } }
        .hamburger { display: none; }
        .hltv-match-container { background: #1a1a1a; border-radius: 8px; overflow: hidden; margin-top: 20px; }
        .hltv-match-header { background: linear-gradient(90deg, #222 0%, #2a2a2a 50%, #222 100%); padding: 25px 30px; text-align: center; border-bottom: 1px solid #333; }
        .hltv-match-tournament { color: #888; font-size: 0.85rem; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 10px; }
        .hltv-match-teams { display: flex; align-items: center; justify-content: center; gap: 50px; }
        .hltv-team { display: flex; flex-direction: column; align-items: center; gap: 10px; }
        .hltv-team-logo { width: 70px; height: 70px; border-radius: 50%; object-fit: cover; border: 3px solid #444; }
        .hltv-team-name { font-weight: 700; font-size: 1.2rem; color: #fff; }
        .hltv-match-score { display: flex; align-items: center; gap: 15px; }
        .hltv-score { font-size: 3rem; font-weight: 800; color: #fff; min-width: 50px; text-align: center; }
        .hltv-score.winner { color: #2ecc71; }
        .hltv-vs { color: #666; font-size: 0.9rem; }
        .hltv-match-date { color: #666; font-size: 0.85rem; margin-top: 15px; }
        .hltv-stats-section { padding: 25px 30px; border-bottom: 1px solid #333; }
        .hltv-section-title { color: #fff; font-size: 1rem; font-weight: 600; margin-bottom: 20px; display: flex; align-items: center; gap: 10px; }
        .hltv-section-title img { width: 24px; height: 24px; border-radius: 50%; }
        .hltv-player-table { width: 100%; border-collapse: collapse; }
        .hltv-player-row { border-bottom: 1px solid #2a2a2a; transition: background 0.2s; cursor: pointer; }
        .hltv-player-row:hover { background: #252525; }
        .hltv-player-row:last-child { border-bottom: none; }
        .hltv-player-cell { padding: 8px 10px; color: #ccc; font-size: 0.85rem; display: flex; align-items: center; gap: 8px; }
        .hltv-player-avatar { width: 24px; height: 24px; border-radius: 50%; object-fit: cover; }
        .hltv-player-name { color: #fff; font-weight: 600; font-size: 0.85rem; }
        .hltv-stat-cell { padding: 8px 6px; text-align: center; color: #ccc; font-size: 0.85rem; }
        .hltv-stat-cell:first-of-type { color: #fff; font-weight: 600; }
        .hltv-rating-cell { padding: 8px 6px; text-align: center; color: #2ecc71; font-weight: 700; font-size: 0.85rem; }
        .hltv-team-stats { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px; }
        .hltv-team-stats:last-child { margin-bottom: 0; }
        .hltv-compare-section { padding: 25px 30px; background: #1f1f1f; }
        .hltv-compare-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px; }
        .hltv-compare-title { color: #fff; font-size: 1.1rem; font-weight: 600; }
        .hltv-compare-selects { display: flex; gap: 15px; }
        .hltv-compare-selects select { background: #2a2a2a; border: 1px solid #444; color: #fff; padding: 10px 15px; border-radius: 4px; font-size: 0.9rem; cursor: pointer; }
        .hltv-compare-selects select:focus { outline: none; border-color: #2ecc71; }
        .hltv-chart-container { height: 350px; display: flex; align-items: center; justify-content: center; }
        .hltv-chart-placeholder { color: #666; font-size: 0.95rem; }
        .hltv-maps { display: flex; gap: 10px; justify-content: center; margin-top: 15px; flex-wrap: wrap; }
        .hltv-map { background: #2a2a2a; padding: 8px 15px; border-radius: 4px; font-size: 0.85rem; color: #888; }
        .hltv-map.winner { background: rgba(46, 204, 113, 0.2); color: #2ecc71; }
        .hltv-map-tabs { display: flex; gap: 8px; padding: 15px 30px; background: #1f1f1f; border-bottom: 1px solid #333; flex-wrap: wrap; }
        .hltv-map-tab { background: #2a2a2a; padding: 10px 18px; border-radius: 4px; font-size: 0.9rem; color: #888; cursor: pointer; transition: all 0.2s; border: 1px solid transparent; }
        .hltv-map-tab:hover { background: #333; color: #fff; }
        .hltv-map-tab.active { background: #2ecc71; color: #fff; border-color: #2ecc71; }
        .admin-match-edit { background: #2a2a2a; padding: 20px; border-radius: 8px; margin-bottom: 20px; }
        .admin-match-edit h4 { color: #fff; margin-bottom: 15px; display: flex; align-items: center; gap: 10px; }
        .admin-map-edit { background: #333; padding: 15px; border-radius: 4px; margin-top: 15px; }
        .admin-map-edit h5 { color: #2ecc71; margin-bottom: 10px; }
        .admin-player-row { display: grid; grid-template-columns: 150px 60px 60px 60px 80px 70px 80px; gap: 8px; align-items: center; margin: 8px 0; padding: 8px; background: #222; border-radius: 4px; }
        .admin-player-row label { color: #888; font-size: 0.8rem; }
        .admin-player-row input { background: #333; border: 1px solid #444; color: #fff; padding: 6px 8px; border-radius: 4px; width: 100%; text-align: center; }
        .admin-player-row input:focus { outline: none; border-color: #2ecc71; }
        .config-section { background: var(--white-color); border-radius: var(--border-radius); padding: 30px; margin-bottom: 25px; box-shadow: var(--shadow); }
        .config-section h3 { margin-bottom: 20px; color: var(--dark-color); display: flex; align-items: center; gap: 10px; }
        .config-section code { background: #f4f4f4; padding: 2px 6px; border-radius: 4px; font-family: 'Courier New', monospace; }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <a href="#" class="logo" data-page="home"><i class="fas fa-gamepad"></i> LDTV</a>
            <div class="hamburger"><i class="fas fa-bars"></i></div>
            <ul class="nav-menu">
                <li class="nav-item"><a href="#" class="nav-link active" data-page="home"><i class="fas fa-calendar-alt"></i> 今日赛程</a></li>
                <li class="nav-item"><a href="#" class="nav-link" data-page="teams"><i class="fas fa-users"></i> 战队排行</a></li>
                <li class="nav-item"><a href="#" class="nav-link" data-page="players"><i class="fas fa-user-astronaut"></i> 选手排名</a></li>
                <li class="nav-item"><a href="#" class="nav-link" data-page="admin"><i class="fas fa-cog"></i> 管理员</a></li>
            </ul>
        </div>
    </nav>

    <div class="container">
        <div id="home-page" class="page active">
            <div class="page-title">
                <h2><i class="fas fa-calendar-alt"></i> 今日赛程</h2>
            </div>
            <div class="tabs">
                <div class="tab active" data-tab="today">今日比赛</div>
                <div class="tab" data-tab="past">往日赛果</div>
                <div class="tab" data-tab="future">未来赛事</div>
            </div>
            <div class="tab-pane active" id="today">
                <div id="today-matches" class="loading-container">
                    <div class="loading-spinner"></div>
                </div>
            </div>
            <div class="tab-pane" id="past">
                <div id="past-matches" class="loading-container">
                    <div class="loading-spinner"></div>
                </div>
            </div>
            <div class="tab-pane" id="future">
                <div id="future-matches" class="loading-container">
                    <div class="loading-spinner"></div>
                </div>
            </div>
        </div>

        <div id="teams-page" class="page">
            <div class="page-title">
                <h2><i class="fas fa-trophy"></i> 战队排行</h2>
                <p class="page-subtitle">根据积分制排名</p>
            </div>
            <div id="teams-list" class="loading-container">
                <div class="loading-spinner"></div>
            </div>
        </div>

        <div id="team-detail-page" class="page">
            <div id="team-detail-content"></div>
        </div>

        <div id="players-page" class="page">
            <div class="page-title">
                <h2><i class="fas fa-user-astronaut"></i> 选手排名</h2>
                <p class="page-subtitle">根据Rating排名</p>
            </div>
            <div id="players-list" class="loading-container">
                <div class="loading-spinner"></div>
            </div>
        </div>

        <div id="player-detail-page" class="page">
            <div id="player-detail-content"></div>
        </div>

        <div id="admin-page" class="page">
            <div class="page-title">
                <h2><i class="fas fa-cog"></i> 管理员面板</h2>
            </div>
            <div id="admin-content"></div>
        </div>

        <div id="match-detail-page" class="page">
            <div id="match-detail-content"></div>
        </div>
    </div>

    <script>
        const CONFIG = {
            STORAGE_KEY: 'ldtv_config',
            supabaseUrl: null,
            supabaseKey: null,
            supabaseClient: null
        };

        function getStorage() {
            try {
                return localStorage || {};
            } catch (e) {
                return { getItem: () => null, setItem: () => {} };
            }
        }

        function loadConfig() {
            try {
                const storage = getStorage();
                const saved = storage.getItem(CONFIG.STORAGE_KEY);
                if (saved) {
                    const config = JSON.parse(saved);
                    CONFIG.supabaseUrl = config.supabaseUrl || null;
                    CONFIG.supabaseKey = config.supabaseKey || null;
                    
                    const urlInput = document.getElementById('supabase-url');
                    const keyInput = document.getElementById('supabase-key');
                    
                    if (urlInput) urlInput.value = CONFIG.supabaseUrl || '';
                    if (keyInput) keyInput.value = CONFIG.supabaseKey || '';
                    
                    // 只在用户手动测试连接时才初始化Supabase
                    // if (CONFIG.supabaseUrl && CONFIG.supabaseKey) {
                    //     initSupabase();
                    // }
                }
            } catch (e) {
                console.warn('无法读取本地配置:', e);
            }
            updateConnectionStatus();
        }

        function saveSupabaseConfig() {
            const url = document.getElementById('supabase-url').value.trim();
            const key = document.getElementById('supabase-key').value.trim();
            
            if (!url || !key) {
                alert('请填写完整的 Supabase 配置信息');
                return;
            }
            
            // 验证URL格式
            if (!url.includes('supabase.co')) {
                alert('请输入正确的 Supabase URL');
                return;
            }
            
            // 验证Key格式
            if (!key.startsWith('eyJ')) {
                alert('请输入正确的 Supabase ANON KEY');
                return;
            }
            
            CONFIG.supabaseUrl = url;
            CONFIG.supabaseKey = key;
            
            try {
                const storage = getStorage();
                storage.setItem(CONFIG.STORAGE_KEY, JSON.stringify({
                    supabaseUrl: url,
                    supabaseKey: key
                }));
            } catch (e) {
                console.warn('无法保存配置到本地存储:', e);
            }
            
            // 延迟初始化，避免阻塞
            setTimeout(() => {
                initSupabase();
                updateConnectionStatus();
            }, 100);
            
            alert('配置已保存！请点击"测试连接"验证连接状态。');
        }

        function initSupabase() {
            try {
                if (!CONFIG.supabaseUrl || !CONFIG.supabaseKey) {
                    console.warn('Supabase URL 或 KEY 未配置');
                    return;
                }
                CONFIG.supabaseClient = supabase.createClient(CONFIG.supabaseUrl, CONFIG.supabaseKey);
                console.log('Supabase 客户端已初始化');
            } catch (error) {
                console.error('Supabase 初始化失败:', error);
            }
        }

        async function testConnection() {
            if (!CONFIG.supabaseClient) {
                alert('请先配置 Supabase 连接信息');
                return;
            }
            
            try {
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 10000);
                
                const { data, error } = await CONFIG.supabaseClient
                    .from('teams')
                    .select('count')
                    .limit(1)
                    .abortSignal(controller.signal);
                
                clearTimeout(timeoutId);
                
                if (error) throw error;
                
                const statusEl = document.getElementById('connection-status');
                if (statusEl) {
                    statusEl.innerHTML = `
                        <div class="alert alert-success">
                            <i class="fas fa-check-circle"></i> 
                            Supabase 连接成功！数据已就绪。
                        </div>
                    `;
                }
                
                loadAllData();
            } catch (error) {
                const statusEl = document.getElementById('connection-status');
                if (statusEl) {
                    statusEl.innerHTML = `
                        <div class="alert alert-danger">
                            <i class="fas fa-times-circle"></i> 
                            连接失败: ${error.name === 'AbortError' ? '连接超时，请检查网络' : error.message}
                        </div>
                    `;
                }
            }
        }

        function updateConnectionStatus() {
            const statusEl = document.getElementById('connection-status');
            if (!statusEl) return;
            
            if (CONFIG.supabaseUrl && CONFIG.supabaseKey) {
                statusEl.innerHTML = `
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle"></i> 
                        Supabase 已配置。点击"测试连接"验证连接状态。
                    </div>
                `;
            }
        }

        function copySQL() {
            const sql = `-- 战队表
CREATE TABLE IF NOT EXISTS teams (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name TEXT NOT NULL,
    logo TEXT,
    points INTEGER DEFAULT 0,
    coach TEXT,
    achievements JSONB DEFAULT '[]'::jsonb,
    players INTEGER[] DEFAULT '{}',
    rank INTEGER,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- 选手表
CREATE TABLE IF NOT EXISTS players (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name TEXT NOT NULL,
    real_name TEXT,
    team_id BIGINT REFERENCES teams(id),
    age INTEGER,
    country TEXT,
    rating DECIMAL(3,2) DEFAULT 1.00,
    img TEXT,
    achievements JSONB DEFAULT '[]'::jsonb,
    stats JSONB DEFAULT '{"firepower":50,"entrying":50,"trading":50,"opening":50,"clutching":50,"utility":50}'::jsonb,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- 比赛表
CREATE TABLE IF NOT EXISTS matches (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    tournament TEXT NOT NULL,
    team1_id BIGINT REFERENCES teams(id),
    team2_id BIGINT REFERENCES teams(id),
    score1 INTEGER,
    score2 INTEGER,
    date DATE NOT NULL,
    time TIME,
    type TEXT DEFAULT 'today',
    maps JSONB DEFAULT '[]'::jsonb,
    stats JSONB DEFAULT '{"team1":{},"team2":{}}'::jsonb,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- 开启实时订阅
ALTER PUBLICATION supabase_realtime ADD TABLE teams;
ALTER PUBLICATION supabase_realtime ADD TABLE players;
ALTER PUBLICATION supabase_realtime ADD TABLE matches;

-- 创建索引
CREATE INDEX IF NOT EXISTS idx_teams_points ON teams(points DESC);
CREATE INDEX IF NOT EXISTS idx_players_rating ON players(rating DESC);
CREATE INDEX IF NOT EXISTS idx_players_team ON players(team_id);
CREATE INDEX IF NOT EXISTS idx_matches_date ON matches(date);
CREATE INDEX IF NOT EXISTS idx_matches_type ON matches(type);`;
            
            navigator.clipboard.writeText(sql).then(() => {
                alert('SQL 代码已复制到剪贴板！');
            }).catch(() => {
                alert('复制失败，请手动复制。');
            });
        }

        async function loadAllData() {
            if (!CONFIG.supabaseClient) return;
            
            try {
                const [teamsResult, playersResult, matchesResult] = await Promise.all([
                    CONFIG.supabaseClient.from('teams').select('*').order('points', { ascending: false }),
                    CONFIG.supabaseClient.from('players').select('*').order('rating', { ascending: false }),
                    CONFIG.supabaseClient.from('matches').select('*').order('date', { ascending: false })
                ]);
                
                if (teamsResult.error) throw teamsResult.error;
                if (playersResult.error) throw playersResult.error;
                if (matchesResult.error) throw matchesResult.error;
                
                window.appData = {
                    teams: teamsResult.data || [],
                    players: playersResult.data || [],
                    matches: matchesResult.data || []
                };
                
                renderSchedule('today');
                loadTeams();
                loadPlayers();
                
            } catch (error) {
                console.error('加载数据失败:', error);
            }
        }

        const appData = {
            teams: [],
            players: [],
            matches: [],
            currentPlayerId: null,
            currentTeamId: null,
            currentMatchId: null,
            radarChart: null,
            compareRadarChart: null,
            adminAuthenticated: false
        };

        async function addTeam(teamData) {
            if (!CONFIG.supabaseClient) {
                alert('请先配置 Supabase 连接');
                return;
            }
            
            const { data, error } = await CONFIG.supabaseClient
                .from('teams')
                .insert([{
                    name: teamData.name,
                    logo: teamData.logo,
                    points: teamData.points || 0,
                    coach: teamData.coach,
                    achievements: teamData.achievements || [],
                    rank: teamData.rank
                }])
                .select()
                .single();
            
            if (error) throw error;
            
            if (data) {
                appData.teams.push(data);
            }
            
            return data;
        }

        async function addPlayer(playerData) {
            if (!CONFIG.supabaseClient) {
                alert('请先配置 Supabase 连接');
                return;
            }
            
            const { data, error } = await CONFIG.supabaseClient
                .from('players')
                .insert([{
                    name: playerData.name,
                    real_name: playerData.realName,
                    team_id: playerData.teamId,
                    age: playerData.age,
                    country: playerData.country,
                    rating: playerData.rating,
                    img: playerData.img,
                    achievements: playerData.achievements || [],
                    stats: playerData.stats
                }])
                .select()
                .single();
            
            if (error) throw error;
            
            if (data) {
                appData.players.push(data);
            }
            
            return data;
        }

        async function addMatch(matchData) {
            if (!CONFIG.supabaseClient) {
                alert('请先配置 Supabase 连接');
                return;
            }
            
            const { data, error } = await CONFIG.supabaseClient
                .from('matches')
                .insert([{
                    tournament: matchData.tournament,
                    team1_id: matchData.team1Id,
                    team2_id: matchData.team2Id,
                    score1: matchData.score1,
                    score2: matchData.score2,
                    date: matchData.date,
                    time: matchData.time,
                    type: matchData.type,
                    maps: matchData.maps || [],
                    stats: matchData.stats || { team1: {}, team2: {} }
                }])
                .select()
                .single();
            
            if (error) throw error;
            return data;
        }

        function getTeam(teamId) {
            return appData.teams.find(t => t.id === teamId);
        }

        function getPlayer(playerId) {
            return appData.players.find(p => p.id === playerId);
        }

        function getMatch(matchId) {
            return appData.matches.find(m => m.id === matchId);
        }

        function getTeamPlayers(teamId) {
            return appData.players.filter(p => p.team_id === teamId);
        }

        function switchPage(pageId) {
            document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
            const targetPage = document.getElementById(pageId + '-page');
            if (targetPage) {
                targetPage.classList.add('active');
            }
            document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));
            const navLink = document.querySelector(`.nav-link[data-page="${pageId}"]`);
            if (navLink) navLink.classList.add('active');
            
            if (pageId === 'home') renderSchedule('today');
            else if (pageId === 'teams') loadTeams();
            else if (pageId === 'players') loadPlayers();
            else if (pageId === 'admin') loadAdminPage();
        }

        function renderSchedule(tabId) {
            const container = document.getElementById(tabId + '-matches');
            
            if (appData.matches.length === 0) {
                container.innerHTML = `
                    <div class="no-data">
                        <i class="fas fa-database"></i>
                        <h3>暂无比赛数据</h3>
                        <p>请在 Supabase 数据库中添加比赛数据</p>
                    </div>
                `;
                return;
            }
            
            const today = new Date().toISOString().split('T')[0];
            let filteredMatches;
            
            if (tabId === 'today') {
                filteredMatches = appData.matches.filter(m => m.date === today && (m.type === 'today' || !m.type));
            } else if (tabId === 'past') {
                filteredMatches = appData.matches.filter(m => m.date < today || m.type === 'past');
            } else {
                filteredMatches = appData.matches.filter(m => m.date > today || m.type === 'upcoming');
            }
            
            if (filteredMatches.length === 0) {
                container.innerHTML = `
                    <div class="no-data">
                        <i class="fas fa-calendar-times"></i>
                        <h3>暂无比赛</h3>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = filteredMatches.map(match => {
                const team1 = getTeam(match.team1_id);
                const team2 = getTeam(match.team2_id);
                if (!team1 || !team2) return '';
                return `
                    <div class="card match-card" style="cursor: pointer;" onclick="showMatchDetail(${match.id})">
                        <div class="match-tournament" style="text-align: center; color: var(--gray-color); margin-bottom: 15px;">
                            ${match.tournament}
                        </div>
                        <div class="match-teams">
                            <div class="match-team">
                                <img src="${team1.logo || 'https://via.placeholder.com/200/2ecc71/FFFFFF?text=' + team1.name.substring(0,2)}" 
                                     alt="${team1.name}" 
                                     class="match-team-logo"
                                     onerror="this.src='https://via.placeholder.com/60/2ecc71/FFFFFF?text=${team1.name.substring(0,2)}'">
                                <span class="match-team-name">${team1.name}</span>
                            </div>
                            ${match.score1 !== null && match.score2 !== null 
                                ? `<div class="match-score">${match.score1} - ${match.score2}</div>`
                                : '<div class="match-vs">VS</div>'
                            }
                            <div class="match-team">
                                <img src="${team2.logo || 'https://via.placeholder.com/200/3498db/FFFFFF?text=' + team2.name.substring(0,2)}" 
                                     alt="${team2.name}" 
                                     class="match-team-logo"
                                     onerror="this.src='https://via.placeholder.com/60/3498db/FFFFFF?text=${team2.name.substring(0,2)}'">
                                <span class="match-team-name">${team2.name}</span>
                            </div>
                        </div>
                        <div class="match-time" style="text-align: center;">
                            ${match.date} ${match.time || ''}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function showMatchDetail(matchId) {
            const match = getMatch(matchId);
            if (!match) return;
            
            appData.currentMatchId = matchId;
            const team1 = getTeam(match.team1_id);
            const team2 = getTeam(match.team2_id);
            if (!team1 || !team2) return;
            
            switchPage('match-detail');
            const stats = match.stats || { team1: {}, team2: {} };
            const team1Players = getTeamPlayers(match.team1_id);
            const team2Players = getTeamPlayers(match.team2_id);
            const isPastMatch = match.type === 'past' || (match.score1 !== null && match.score2 !== null);
            const maps = match.maps || [];
            const score1 = match.score1 !== null ? match.score1 : 0;
            const score2 = match.score2 !== null ? match.score2 : 0;
            const team1Won = isPastMatch && score1 > score2;
            const team2Won = isPastMatch && score2 > score1;
            
            const player1Options = team1Players.map(p => `<option value="${p.id}">${p.name}</option>`).join('');
            const player2Options = team2Players.map(p => `<option value="${p.id}">${p.name}</option>`).join('');
            
            function createPlayerRows(playerStats, players, teamId) {
                return players.map(player => {
                    const pStats = playerStats && playerStats[player.id] ? playerStats[player.id] : { kill: 0, death: 0, swing: 0, adr: 0, kast: 0, rating: 0 };
                    return `
                        <tr class="hltv-player-row" onclick="showPlayerDetail(${player.id})">
                            <td class="hltv-player-cell">
                                <img src="${player.img || 'https://via.placeholder.com/24/2ecc71/FFFFFF?text=' + player.name.substring(0,1)}" 
                                     alt="${player.name}" 
                                     class="hltv-player-avatar"
                                     onerror="this.src='https://via.placeholder.com/24/2ecc71/FFFFFF?text=${player.name.substring(0,1)}'">
                                <span class="hltv-player-name">${player.name}</span>
                            </td>
                            <td class="hltv-stat-cell">${pStats.kill}</td>
                            <td class="hltv-stat-cell">${pStats.death}</td>
                            <td class="hltv-stat-cell">${pStats.swing}</td>
                            <td class="hltv-stat-cell">${pStats.adr.toFixed(1)}</td>
                            <td class="hltv-stat-cell">${pStats.kast}%</td>
                            <td class="hltv-rating-cell">${pStats.rating.toFixed(2)}</td>
                        </tr>
                    `;
                }).join('');
            }
            
            function createStatsSection(mapIndex, mapData, mapStats) {
                const mapName = mapData.name;
                const mapScore1 = mapData.score1;
                const mapScore2 = mapData.score2;
                const mapWinner = isPastMatch && mapScore1 > mapScore2 ? 1 : (isPastMatch && mapScore2 > mapScore1 ? 2 : 0);
                const team1Rows = createPlayerRows(mapStats?.team1 || {}, team1Players, match.team1_id);
                const team2Rows = createPlayerRows(mapStats?.team2 || {}, team2Players, match.team2_id);
                
                return `
                    <div class="hltv-stats-section" data-map="${mapIndex}" style="display: ${mapIndex === -1 ? 'block' : 'none'};">
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px;">
                            <div class="hltv-section-title" style="margin-bottom: 0;">
                                <i class="fas fa-crosshairs"></i> ${mapName}
                            </div>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <img src="${team1.logo || 'https://via.placeholder.com/24/2ecc71/FFFFFF?text=' + team1.name.substring(0,1)}" 
                                     style="width: 24px; height: 24px; border-radius: 50%;"
                                     onerror="this.src='https://via.placeholder.com/24/2ecc71/FFFFFF?text=${team1.name.substring(0,1)}'">
                                <span style="font-weight: 700; font-size: 1.2rem; color: ${mapWinner === 1 ? '#2ecc71' : '#fff'};">${mapScore1}</span>
                                <span style="color: #666;">-</span>
                                <span style="font-weight: 700; font-size: 1.2rem; color: ${mapWinner === 2 ? '#2ecc71' : '#fff'};">${mapScore2}</span>
                                <img src="${team2.logo || 'https://via.placeholder.com/24/3498db/FFFFFF?text=' + team2.name.substring(0,1)}" 
                                     style="width: 24px; height: 24px; border-radius: 50%;"
                                     onerror="this.src='https://via.placeholder.com/24/3498db/FFFFFF?text=${team2.name.substring(0,1)}'">
                            </div>
                        </div>
                        <div class="hltv-team-stats">
                            <div>
                                <div class="hltv-section-title">
                                    <img src="${team1.logo || 'https://via.placeholder.com/24/2ecc71/FFFFFF?text=' + team1.name.substring(0,1)}" 
                                         alt="${team1.name}"
                                         onerror="this.src='https://via.placeholder.com/24/2ecc71/FFFFFF?text=${team1.name.substring(0,1)}'"> 
                                    ${team1.name}
                                </div>
                                <table class="hltv-player-table" style="width:100%;border-collapse:collapse;">
                                    <thead>
                                        <tr style="color:#888;font-size:0.75rem;text-transform:uppercase;">
                                            <th style="padding:8px 10px;text-align:left;border-bottom:1px solid #333;">选手</th>
                                            <th style="padding:8px 6px;text-align:center;border-bottom:1px solid #333;">K</th>
                                            <th style="padding:8px 6px;text-align:center;border-bottom:1px solid #333;">D</th>
                                            <th style="padding:8px 6px;text-align:center;border-bottom:1px solid #333;">A</th>
                                            <th style="padding:8px 6px;text-align:center;border-bottom:1px solid #333;">ADR</th>
                                            <th style="padding:8px 6px;text-align:center;border-bottom:1px solid #333;">KAST</th>
                                            <th style="padding:8px 6px;text-align:center;border-bottom:1px solid #333;">Rating</th>
                                        </tr>
                                    </thead>
                                    <tbody>${team1Rows}</tbody>
                                </table>
                            </div>
                            <div>
                                <div class="hltv-section-title">
                                    <img src="${team2.logo || 'https://via.placeholder.com/24/3498db/FFFFFF?text=' + team2.name.substring(0,1)}" 
                                         alt="${team2.name}"
                                         onerror="this.src='https://via.placeholder.com/24/3498db/FFFFFF?text=${team2.name.substring(0,1)}'"> 
                                    ${team2.name}
                                </div>
                                <table class="hltv-player-table" style="width:100%;border-collapse:collapse;">
                                    <thead>
                                        <tr style="color:#888;font-size:0.75rem;text-transform:uppercase;">
                                            <th style="padding:8px 10px;text-align:left;border-bottom:1px solid #333;">选手</th>
                                            <th style="padding:8px 6px;text-align:center;border-bottom:1px solid #333;">K</th>
                                            <th style="padding:8px 6px;text-align:center;border-bottom:1px solid #333;">D</th>
                                            <th style="padding:8px 6px;text-align:center;border-bottom:1px solid #333;">A</th>
                                            <th style="padding:8px 6px;text-align:center;border-bottom:1px solid #333;">ADR</th>
                                            <th style="padding:8px 6px;text-align:center;border-bottom:1px solid #333;">KAST</th>
                                            <th style="padding:8px 6px;text-align:center;border-bottom:1px solid #333;">Rating</th>
                                        </tr>
                                    </thead>
                                    <tbody>${team2Rows}</tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            let mapTabsHtml = '';
            let mapStatsHtml = '';
            
            if (maps.length > 0) {
                const allMapsTab = `<span class="hltv-map-tab${isPastMatch ? '' : ' active'}" data-map="-1" onclick="switchMapTab(this, -1)">总计</span>`;
                const individualMapTabs = maps.map((map, idx) => {
                    const mapWinner = isPastMatch && map.score1 > map.score2 ? 1 : (isPastMatch && map.score2 > map.score1 ? 2 : 0);
                    return `
                        <span class="hltv-map-tab${!isPastMatch && idx === 0 ? ' active' : ''}" 
                              data-map="${idx}" 
                              onclick="switchMapTab(this, ${idx})">
                            ${map.name} 
                            <span style="color: ${mapWinner === 1 ? '#2ecc71' : mapWinner === 2 ? '#e74c3c' : '#666'};">
                                (${map.score1}-${map.score2})
                            </span>
                        </span>
                    `;
                }).join('');
                
                mapTabsHtml = `<div class="hltv-map-tabs">${allMapsTab}${individualMapTabs}</div>`;
                mapStatsHtml = maps.map((map, idx) => createStatsSection(idx, map, map.stats)).join('');
            }
            
            let compareSectionHtml = '';
            if (isPastMatch && team1Players.length > 0 && team2Players.length > 0) {
                compareSectionHtml = `
                    <div class="hltv-compare-section">
                        <div class="hltv-compare-header">
                            <div class="hltv-compare-title">
                                <i class="fas fa-balance-scale"></i> 选手能力对比
                            </div>
                            <div class="hltv-compare-selects">
                                <select id="compare-player-1" onchange="compareMatchPlayers()">
                                    <option value="">选择 ${team1.name} 选手</option>
                                    ${player1Options}
                                </select>
                                <select id="compare-player-2" onchange="compareMatchPlayers()">
                                    <option value="">选择 ${team2.name} 选手</option>
                                    ${player2Options}
                                </select>
                            </div>
                        </div>
                        <div class="hltv-chart-container">
                            <canvas id="match-compare-radar-chart"></canvas>
                        </div>
                    </div>
                `;
            }
            
            document.getElementById('match-detail-content').innerHTML = `
                <button class="back-btn" onclick="switchPage('home')">
                    <i class="fas fa-arrow-left"></i> 返回赛程
                </button>
                <div class="hltv-match-container">
                    <div class="hltv-match-header">
                        <div class="hltv-match-tournament">${match.tournament}</div>
                        <div class="hltv-match-teams">
                            <div class="hltv-team">
                                <img src="${team1.logo || 'https://via.placeholder.com/70/2ecc71/FFFFFF?text=' + team1.name.substring(0,2)}" 
                                     alt="${team1.name}" 
                                     class="hltv-team-logo"
                                     onerror="this.src='https://via.placeholder.com/70/2ecc71/FFFFFF?text=${team1.name.substring(0,2)}'">
                                <span class="hltv-team-name">${team1.name}</span>
                            </div>
                            <div class="hltv-match-score">
                                <span class="hltv-score${team1Won ? ' winner' : ''}">${match.score1 !== null ? score1 : '-'}</span>
                                <span class="hltv-vs">VS</span>
                                <span class="hltv-score${team2Won ? ' winner' : ''}">${match.score2 !== null ? score2 : '-'}</span>
                            </div>
                            <div class="hltv-team">
                                <img src="${team2.logo || 'https://via.placeholder.com/70/3498db/FFFFFF?text=' + team2.name.substring(0,2)}" 
                                     alt="${team2.name}" 
                                     class="hltv-team-logo"
                                     onerror="this.src='https://via.placeholder.com/70/3498db/FFFFFF?text=${team2.name.substring(0,2)}'">
                                <span class="hltv-team-name">${team2.name}</span>
                            </div>
                        </div>
                        <div class="hltv-match-date">${match.date}${match.time ? ' ' + match.time : ''}</div>
                    </div>
                    ${mapTabsHtml}
                    <div id="map-stats-container">
                        ${isPastMatch ? createStatsSection(-1, { name: '总计', score1: score1, score2: score2 }, stats) : ''}
                        ${mapStatsHtml}
                    </div>
                    ${compareSectionHtml}
                </div>
            `;
            
            if (isPastMatch) {
                setTimeout(() => compareMatchPlayers(), 300);
            }
        }

        function switchMapTab(element, mapIndex) {
            document.querySelectorAll('.hltv-map-tab').forEach(tab => tab.classList.remove('active'));
            element.classList.add('active');
            document.querySelectorAll('.hltv-stats-section').forEach(section => {
                section.style.display = 'none';
            });
            
            if (mapIndex === -1) {
                const totalSection = document.querySelector('.hltv-stats-section[data-map="-1"]');
                if (totalSection) totalSection.style.display = 'block';
            } else {
                const targetSection = document.querySelector(`.hltv-stats-section[data-map="${mapIndex}"]`);
                if (targetSection) targetSection.style.display = 'block';
            }
        }

        function compareMatchPlayers() {
            const playerId1 = parseInt(document.getElementById('compare-player-1')?.value);
            const playerId2 = parseInt(document.getElementById('compare-player-2')?.value);
            const canvas = document.getElementById('match-compare-radar-chart');
            
            if (!canvas) return;
            
            if (!playerId1 || !playerId2) {
                const ctx = canvas.getContext('2d');
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.font = '16px Arial';
                ctx.fillStyle = '#7f8c8d';
                ctx.textAlign = 'center';
                ctx.fillText('请选择两位选手进行对比', canvas.width / 2, canvas.height / 2);
                return;
            }
            
            const player1 = getPlayer(playerId1);
            const player2 = getPlayer(playerId2);
            if (!player1 || !player2) return;
            
            const stats1 = player1.stats || {};
            const stats2 = player2.stats || {};
            const data1 = [stats1.firepower || 50, stats1.entrying || 50, stats1.trading || 50, stats1.opening || 50, stats1.clutching || 50, stats1.sniping || 50, stats1.utility || 50];
            const data2 = [stats2.firepower || 50, stats2.entrying || 50, stats2.trading || 50, stats2.opening || 50, stats2.clutching || 50, stats2.sniping || 50, stats2.utility || 50];
            
            const ctx = canvas.getContext('2d');
            canvas.width = canvas.parentElement.offsetWidth || 500;
            canvas.height = canvas.parentElement.offsetHeight || 350;
            
            if (window.matchCompareChart) {
                try { window.matchCompareChart.destroy(); } catch(e) {}
            }
            
            window.matchCompareChart = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['火力', '突破', '补枪', '首杀', '残局', '狙击', '道具'],
                    datasets: [{
                        label: player1.name,
                        data: data1,
                        backgroundColor: 'rgba(46, 204, 113, 0.2)',
                        borderColor: 'rgba(46, 204, 113, 1)',
                        borderWidth: 2,
                        pointBackgroundColor: 'rgba(46, 204, 113, 1)'
                    }, {
                        label: player2.name,
                        data: data2,
                        backgroundColor: 'rgba(52, 152, 219, 0.2)',
                        borderColor: 'rgba(52, 152, 219, 1)',
                        borderWidth: 2,
                        pointBackgroundColor: 'rgba(52, 152, 219, 1)'
                    }]
                },
                options: {
                    responsive: false,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            beginAtZero: true,
                            min: 0,
                            max: 100,
                            ticks: { stepSize: 20 }
                        }
                    }
                }
            });
        }

        function loadTeams() {
            const container = document.getElementById('teams-list');
            
            if (appData.teams.length === 0) {
                container.innerHTML = `
                    <div class="no-data">
                        <i class="fas fa-users"></i>
                        <h3>暂无战队数据</h3>
                        <p>请在 Supabase 数据库中添加战队数据</p>
                    </div>
                `;
                return;
            }
            
            const sortedTeams = [...appData.teams].sort((a, b) => (b.points || 0) - (a.points || 0));
            
            container.innerHTML = '<div class="team-table">' + sortedTeams.map((team, index) => {
                const players = getTeamPlayers(team.id);
                let rankClass = '';
                if (index === 0) rankClass = 'gold';
                else if (index === 1) rankClass = 'silver';
                else if (index === 2) rankClass = 'bronze';
                
                return `
                    <div class="team-row" onclick="showTeamDetail(${team.id})">
                        <div class="team-rank ${rankClass}">${index + 1}</div>
                        <img src="${team.logo || 'https://via.placeholder.com/60/2ecc71/FFFFFF?text=' + team.name.substring(0,2)}" 
                             alt="${team.name}" 
                             class="team-logo"
                             onerror="this.src='https://via.placeholder.com/60/2ecc71/FFFFFF?text=${team.name.substring(0,2)}'">
                        <div class="team-info">
                            <h3>${team.name}</h3>
                            <p class="team-coach">教练: ${team.coach || '未设置'}</p>
                        </div>
                        <div class="team-players">
                            ${players.slice(0, 5).map(p => `
                                <div class="player-chip" onclick="event.stopPropagation(); showPlayerDetail(${p.id})">
                                    <img src="${p.img || 'https://via.placeholder.com/24/2ecc71/FFFFFF?text=' + p.name.substring(0,1)}" 
                                         alt="${p.name}"
                                         onerror="this.src='https://via.placeholder.com/24/2ecc71/FFFFFF?text=${p.name.substring(0,1)}'">
                                    <span>${p.name}</span>
                                </div>
                            `).join('')}
                        </div>
                        <div class="team-points">${team.points || 0} 积分</div>
                    </div>
                `;
            }).join('') + '</div>';
        }

        function showTeamDetail(teamId) {
            const team = getTeam(teamId);
            if (!team) return;
            
            appData.currentTeamId = teamId;
            const players = getTeamPlayers(teamId);
            switchPage('team-detail');
            
            const achievements = team.achievements || [];
            
            document.getElementById('team-detail-content').innerHTML = `
                <button class="back-btn" onclick="switchPage('teams')">
                    <i class="fas fa-arrow-left"></i> 返回战队列表
                </button>
                <div style="margin-top: 20px;">
                    <div class="team-detail-header">
                        <img src="${team.logo || 'https://via.placeholder.com/120/2ecc71/FFFFFF?text=' + team.name.substring(0,2)}" 
                             alt="${team.name}" 
                             class="team-detail-logo"
                             onerror="this.src='https://via.placeholder.com/120/2ecc71/FFFFFF?text=${team.name.substring(0,2)}'">
                        <div class="team-detail-info">
                            <h1>${team.name}</h1>
                            <p>教练: ${team.coach || '未设置'}</p>
                            <p>积分: ${team.points || 0}</p>
                            <p>排名: 第 ${team.rank || '-'} 名</p>
                        </div>
                    </div>
                    <div class="card">
                        <h3 style="margin-bottom: 20px;">
                            <i class="fas fa-trophy"></i> 战队成就
                        </h3>
                        ${achievements.length > 0 
                            ? `<ul class="achievement-list">${achievements.map(a => `<li><i class="fas fa-medal"></i> ${a}</li>`).join('')}</ul>`
                            : '<p style="color: var(--gray-color);">暂无成就</p>'
                        }
                    </div>
                    <div class="card">
                        <h3 style="margin-bottom: 20px;">
                            <i class="fas fa-users"></i> 队员列表
                        </h3>
                        <div class="player-table">
                            ${players.map(p => `
                                <div class="player-row" onclick="showPlayerDetail(${p.id})">
                                    <span class="player-rank">#</span>
                                    <img src="${p.img || 'https://via.placeholder.com/50/2ecc71/FFFFFF?text=' + p.name.substring(0,1)}" 
                                         alt="${p.name}" 
                                         class="player-avatar"
                                         onerror="this.src='https://via.placeholder.com/50/2ecc71/FFFFFF?text=${p.name.substring(0,1)}'">
                                    <div class="player-info">
                                        <div class="player-name">${p.name}</div>
                                        <div class="player-team">${p.country || ''} | Rating: ${(p.rating || 1.00).toFixed(2)}</div>
                                    </div>
                                    <div class="player-rating">${(p.rating || 1.00).toFixed(2)}</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
        }

        function loadPlayers() {
            const container = document.getElementById('players-list');
            
            if (appData.players.length === 0) {
                container.innerHTML = `
                    <div class="no-data">
                        <i class="fas fa-user-astronaut"></i>
                        <h3>暂无选手数据</h3>
                        <p>请在 Supabase 数据库中添加选手数据</p>
                    </div>
                `;
                return;
            }
            
            const sortedPlayers = [...appData.players].sort((a, b) => (b.rating || 0) - (a.rating || 0));
            
            container.innerHTML = '<div class="player-table">' + sortedPlayers.map((player, index) => {
                const team = getTeam(player.team_id);
                return `
                    <div class="player-row" onclick="showPlayerDetail(${player.id})">
                        <span class="player-rank">${index + 1}</span>
                        <img src="${player.img || 'https://via.placeholder.com/50/2ecc71/FFFFFF?text=' + player.name.substring(0,1)}" 
                             alt="${player.name}" 
                             class="player-avatar"
                             onerror="this.src='https://via.placeholder.com/50/2ecc71/FFFFFF?text=${player.name.substring(0,1)}'">
                        <div class="player-info">
                            <div class="player-name">${player.name}</div>
                            <div class="player-team">${team ? team.name : '未知战队'} | ${player.country || ''}</div>
                        </div>
                        <div class="player-rating">${(player.rating || 1.00).toFixed(2)}</div>
                    </div>
                `;
            }).join('') + '</div>';
        }

        function showPlayerDetail(playerId) {
            const player = getPlayer(playerId);
            if (!player) return;
            
            appData.currentPlayerId = playerId;
            const team = getPlayer(player.team_id) ? getTeam(player.team_id) : null;
            const stats = player.stats || {};
            switchPage('player-detail');
            
            document.getElementById('player-detail-content').innerHTML = `
                <button class="back-btn" onclick="switchPage('players')">
                    <i class="fas fa-arrow-left"></i> 返回选手列表
                </button>
                <div style="margin-top: 20px;">
                    <div class="player-detail-header">
                        <img src="${player.img || 'https://via.placeholder.com/150/2ecc71/FFFFFF?text=' + player.name.substring(0,1)}" 
                             alt="${player.name}" 
                             class="player-detail-avatar"
                             onerror="this.src='https://via.placeholder.com/150/2ecc71/FFFFFF?text=${player.name.substring(0,1)}'">
                        <div class="player-detail-info">
                            <h1>${player.name}</h1>
                            <p>真实姓名: ${player.real_name || player.name}</p>
                            <p>年龄: ${player.age || '未知'}</p>
                            <p>国籍: ${player.country || '未知'}</p>
                            <p>所属战队: ${team ? team.name : '未知'}</p>
                            <p>Rating: ${(player.rating || 1.00).toFixed(2)}</p>
                        </div>
                    </div>
                    <div class="card">
                        <h3 style="margin-bottom: 20px;">
                            <i class="fas fa-chart-pie"></i> 能力雷达图
                        </h3>
                        <div class="stats-radar-container">
                            <canvas id="player-radar-chart"></canvas>
                        </div>
                        <div class="stats-grid">
                            <div class="stat-item">
                                <label>Rating 3.0</label>
                                <input type="text" value="${(player.rating || 1.00).toFixed(2)}" readonly>
                            </div>
                            <div class="stat-item">
                                <label>火力 (Firepower)</label>
                                <input type="text" value="${stats.firepower || 50}" readonly>
                            </div>
                            <div class="stat-item">
                                <label>突破 (Entrying)</label>
                                <input type="text" value="${stats.entrying || 50}" readonly>
                            </div>
                            <div class="stat-item">
                                <label>补枪 (Trading)</label>
                                <input type="text" value="${stats.trading || 50}" readonly>
                            </div>
                            <div class="stat-item">
                                <label>首杀 (Opening)</label>
                                <input type="text" value="${stats.opening || 50}" readonly>
                            </div>
                            <div class="stat-item">
                                <label>残局 (Clutching)</label>
                                <input type="text" value="${stats.clutching || 50}" readonly>
                            </div>
                            <div class="stat-item">
                                <label>狙击 (Sniping)</label>
                                <input type="text" value="${stats.sniping || 50}" readonly>
                            </div>
                            <div class="stat-item">
                                <label>道具 (Utility)</label>
                                <input type="text" value="${stats.utility || 50}" readonly>
                            </div>
                        </div>
                    </div>
                    <div class="card">
                        <h3 style="margin-bottom: 20px;">
                            <i class="fas fa-trophy"></i> 个人成就
                        </h3>
                        ${(player.achievements || []).length > 0 
                            ? `<ul class="achievement-list">${player.achievements.map(a => `<li><i class="fas fa-medal"></i> ${a}</li>`).join('')}</ul>`
                            : '<p style="color: var(--gray-color);">暂无成就</p>'
                        }
                    </div>
                </div>
            `;
            
            setTimeout(() => initPlayerRadarChart(player), 200);
        }

        function initPlayerRadarChart(player) {
            const container = document.getElementById('player-radar-chart');
            if (!container) return;
            
            const stats = player.stats || {};
            const chartData = [
                stats.firepower || 50,
                stats.entrying || 50,
                stats.trading || 50,
                stats.opening || 50,
                stats.clutching || 50,
                stats.sniping || 50,
                stats.utility || 50
            ];
            
            const ctx = container.getContext('2d');
            if (window.radarChartInstance) {
                try { window.radarChartInstance.destroy(); } catch(e) {}
            }
            
            container.width = container.parentElement.offsetWidth || 500;
            container.height = container.parentElement.offsetHeight || 350;
            
            window.radarChartInstance = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['火力', '突破', '补枪', '首杀', '残局', '狙击', '道具'],
                    datasets: [{
                        label: player.name,
                        data: chartData,
                        backgroundColor: 'rgba(46, 204, 113, 0.25)',
                        borderColor: 'rgba(46, 204, 113, 1)',
                        borderWidth: 2,
                        pointBackgroundColor: 'rgba(46, 204, 113, 1)',
                        pointBorderColor: '#fff',
                        pointRadius: 4
                    }]
                },
                options: {
                    responsive: false,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            beginAtZero: true,
                            min: 0,
                            max: 100,
                            ticks: { stepSize: 20 }
                        }
                    }
                }
            });
        }

        function adminLogin() {
            const password = document.getElementById('admin-password').value;
            const adminPassword = localStorage.getItem('adminPassword') || 'LD12345';
            
            if (password === adminPassword) {
                appData.adminAuthenticated = true;
                localStorage.setItem('adminAuthenticated', 'true');
                loadAdminPage();
            } else {
                alert('密码错误！');
            }
        }

        function adminLogout() {
            appData.adminAuthenticated = false;
            localStorage.setItem('adminAuthenticated', 'false');
            loadAdminPage();
        }

        function loadAdminPage() {
            const container = document.getElementById('admin-content');
            
            if (!appData.adminAuthenticated) {
                container.innerHTML = `
                    <div class="admin-login">
                        <div class="card">
                            <h2 style="margin-bottom: 30px; text-align: center;">
                                <i class="fas fa-shield-alt"></i> 管理员登录
                            </h2>
                            <div class="input-group">
                                <i class="fas fa-lock"></i>
                                <input type="password" id="admin-password" placeholder="请输入管理员密码">
                            </div>
                            <button class="btn btn-primary btn-block" onclick="adminLogin()">登录</button>
                        </div>
                    </div>
                `;
            } else {
                container.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                        <h2><i class="fas fa-cogs"></i> 数据管理</h2>
                        <div>
                            <button class="btn btn-secondary btn-sm" onclick="adminLogout()">
                                <i class="fas fa-sign-out-alt"></i> 退出登录
                            </button>
                        </div>
                    </div>
                    <div class="tabs" style="margin-bottom: 25px;">
                        <div class="tab active" data-admin-tab="config">数据库配置</div>
                        <div class="tab" data-admin-tab="teams">战队管理</div>
                        <div class="tab" data-admin-tab="players">选手管理</div>
                        <div class="tab" data-admin-tab="matches">赛事管理</div>
                    </div>
                    <div id="admin-config" class="admin-tab-content">
                        <div class="config-section">
                            <h3><i class="fas fa-key"></i> Supabase 配置</h3>
                            <div class="form-group">
                                <label>Supabase URL</label>
                                <input type="text" id="supabase-url" class="form-control" placeholder="https://your-project.supabase.co" value="${CONFIG.supabaseUrl || ''}">
                            </div>
                            <div class="form-group">
                                <label>Supabase ANON KEY</label>
                                <input type="text" id="supabase-key" class="form-control" placeholder="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..." value="${CONFIG.supabaseKey || ''}">
                            </div>
                            <button class="btn btn-primary" onclick="saveSupabaseConfig()">
                                <i class="fas fa-save"></i> 保存配置
                            </button>
                            <button class="btn btn-secondary" onclick="testConnection()" style="margin-left: 10px;">
                                <i class="fas fa-wifi"></i> 测试连接
                            </button>
                        </div>
                        <div class="config-section">
                            <h3><i class="fas fa-plug"></i> 连接状态</h3>
                            <div id="connection-status">
                                ${CONFIG.supabaseUrl && CONFIG.supabaseKey 
                                    ? `<div class="alert alert-info"><i class="fas fa-info-circle"></i> Supabase 已配置。点击"测试连接"验证连接状态。</div>`
                                    : `<div class="alert alert-warning"><i class="fas fa-exclamation-triangle"></i> 尚未配置 Supabase 数据库连接。</div>`
                                }
                            </div>
                        </div>
                        <div class="config-section">
                            <h3><i class="fas fa-code"></i> Supabase SQL 建表语句</h3>
                            <p style="margin-bottom: 15px; color: var(--gray-color);">
                                请在 Supabase 的 <strong>SQL Editor</strong> 中执行以下代码来创建所需的表：
                            </p>
                            <pre style="background: #1a1a1a; color: #ccc; padding: 20px; border-radius: 8px; overflow-x: auto; font-size: 0.9rem; line-height: 1.6; max-height: 400px; overflow-y: auto;">
-- 删除旧的 RLS 策略（如果有）
DROP POLICY IF EXISTS "Allow public read access" ON teams;
DROP POLICY IF EXISTS "Allow public read access" ON players;
DROP POLICY IF EXISTS "Allow public read access" ON matches;
DROP POLICY IF EXISTS "Admin full access" ON teams;
DROP POLICY IF EXISTS "Admin full access" ON players;
DROP POLICY IF EXISTS "Admin full access" ON matches;

-- 战队表
CREATE TABLE IF NOT EXISTS teams (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name TEXT NOT NULL,
    logo TEXT,
    points INTEGER DEFAULT 0,
    coach TEXT,
    achievements JSONB DEFAULT '[]'::jsonb,
    players INTEGER[] DEFAULT '{}',
    rank INTEGER,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- 选手表
CREATE TABLE IF NOT EXISTS players (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name TEXT NOT NULL,
    real_name TEXT,
    team_id BIGINT REFERENCES teams(id),
    age INTEGER,
    country TEXT,
    rating DECIMAL(3,2) DEFAULT 1.00,
    img TEXT,
    achievements JSONB DEFAULT '[]'::jsonb,
    stats JSONB DEFAULT '{"firepower":50,"entrying":50,"trading":50,"opening":50,"clutching":50,"sniping":50,"utility":50}'::jsonb,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- 比赛表
CREATE TABLE IF NOT EXISTS matches (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    tournament TEXT NOT NULL,
    team1_id BIGINT REFERENCES teams(id),
    team2_id BIGINT REFERENCES teams(id),
    score1 INTEGER,
    score2 INTEGER,
    date DATE NOT NULL,
    time TIME,
    type TEXT DEFAULT 'today',
    maps JSONB DEFAULT '[]'::jsonb,
    stats JSONB DEFAULT '{"team1":{},"team2":{}}'::jsonb,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- 关闭 RLS（允许所有人读写）- 如果不需要严格安全控制
ALTER TABLE teams DISABLE ROW LEVEL SECURITY;
ALTER TABLE players DISABLE ROW LEVEL SECURITY;
ALTER TABLE matches DISABLE ROW LEVEL SECURITY;

-- 创建索引
CREATE INDEX IF NOT EXISTS idx_teams_points ON teams(points DESC);
CREATE INDEX IF NOT EXISTS idx_players_rating ON players(rating DESC);
CREATE INDEX IF NOT EXISTS idx_players_team ON players(team_id);
CREATE INDEX IF NOT EXISTS idx_matches_date ON matches(date);
CREATE INDEX IF NOT EXISTS idx_matches_type ON matches(type);
                            </pre>
                            <button class="btn btn-secondary" onclick="copySQL()" style="margin-top: 15px;">
                                <i class="fas fa-copy"></i> 复制 SQL
                            </button>
                        </div>
                    </div>
                        <div class="card">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                                <h3>战队列表</h3>
                                <button class="btn btn-primary" onclick="openTeamModal()">
                                    <i class="fas fa-plus"></i> 添加战队
                                </button>
                            </div>
                            ${appData.teams.length === 0 
                                ? `<p style="text-align: center; padding: 40px; color: var(--gray-color);">暂无战队数据</p>`
                                : `<table class="data-table">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Logo</th>
                                            <th>战队名称</th>
                                            <th>积分</th>
                                            <th>教练</th>
                                            <th>操作</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${appData.teams.map(team => `
                                            <tr>
                                                <td>${team.id}</td>
                                                <td><img src="${team.logo || 'https://via.placeholder.com/40'}" onerror="this.src='https://via.placeholder.com/40'"></td>
                                                <td>${team.name}</td>
                                                <td>${team.points || 0}</td>
                                                <td>${team.coach || '-'}</td>
                                                <td class="action-btns">
                                                    <button class="action-btn edit" onclick="openTeamModal(${team.id})"><i class="fas fa-edit"></i></button>
                                                    <button class="action-btn delete" onclick="deleteTeam(${team.id})"><i class="fas fa-trash"></i></button>
                                                </td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>`
                            }
                        </div>
                    </div>
                    <div id="admin-players" class="admin-tab-content" style="display: none;">
                        <div class="card">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                                <h3>选手列表</h3>
                                <button class="btn btn-primary" onclick="openPlayerModal()">
                                    <i class="fas fa-plus"></i> 添加选手
                                </button>
                            </div>
                            ${appData.players.length === 0 
                                ? `<p style="text-align: center; padding: 40px; color: var(--gray-color);">暂无选手数据</p>`
                                : `<table class="data-table">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>头像</th>
                                            <th>选手名称</th>
                                            <th>战队</th>
                                            <th>Rating</th>
                                            <th>操作</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${appData.players.map(player => {
                                            const team = getTeam(player.team_id);
                                            return `
                                                <tr>
                                                    <td>${player.id}</td>
                                                    <td><img src="${player.img || 'https://via.placeholder.com/40'}" onerror="this.src='https://via.placeholder.com/40'"></td>
                                                    <td>${player.name}</td>
                                                    <td>${team ? team.name : '未分配'}</td>
                                                    <td>${(player.rating || 1.00).toFixed(2)}</td>
                                                    <td class="action-btns">
                                                        <button class="action-btn edit" onclick="openPlayerModal(${player.id})"><i class="fas fa-edit"></i></button>
                                                        <button class="action-btn delete" onclick="deletePlayer(${player.id})"><i class="fas fa-trash"></i></button>
                                                    </td>
                                                </tr>
                                            `;
                                        }).join('')}
                                    </tbody>
                                </table>`
                            }
                        </div>
                    </div>
                    <div id="admin-matches" class="admin-tab-content" style="display: none;">
                        <div class="card">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                                <h3>赛事列表</h3>
                                <button class="btn btn-primary" onclick="openMatchModal()">
                                    <i class="fas fa-plus"></i> 添加比赛
                                </button>
                            </div>
                            ${appData.matches.length === 0 
                                ? `<p style="text-align: center; padding: 40px; color: var(--gray-color);">暂无比赛数据</p>`
                                : `<table class="data-table">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>赛事</th>
                                            <th>战队1</th>
                                            <th>比分</th>
                                            <th>战队2</th>
                                            <th>日期</th>
                                            <th>操作</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${appData.matches.map(match => {
                                            const team1 = getTeam(match.team1_id);
                                            const team2 = getTeam(match.team2_id);
                                            return `
                                                <tr>
                                                    <td>${match.id}</td>
                                                    <td>${match.tournament}</td>
                                                    <td>${team1 ? team1.name : '未知'}</td>
                                                    <td>${match.score1 !== null ? match.score1 : '-'} - ${match.score2 !== null ? match.score2 : '-'}</td>
                                                    <td>${team2 ? team2.name : '未知'}</td>
                                                    <td>${match.date}</td>
                                                    <td class="action-btns">
                                                        <button class="action-btn edit" onclick="openMatchModal(${match.id})"><i class="fas fa-edit"></i></button>
                                                        <button class="action-btn delete" onclick="deleteMatch(${match.id})"><i class="fas fa-trash"></i></button>
                                                    </td>
                                                </tr>
                                            `;
                                        }).join('')}
                                    </tbody>
                                </table>`
                            }
                        </div>
                    </div>
                `;
                initAdminTabs();
            }
        }

        function initAdminTabs() {
            document.querySelectorAll('.tabs .tab').forEach(tab => {
                tab.onclick = function() {
                    document.querySelectorAll('.tabs .tab').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    document.querySelectorAll('.admin-tab-content').forEach(c => c.style.display = 'none');
                    const tabId = this.getAttribute('data-admin-tab');
                    document.getElementById('admin-' + tabId).style.display = 'block';
                };
            });
        }

        function initEventListeners() {
            document.querySelectorAll('.nav-link, .logo').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const pageId = this.getAttribute('data-page');
                    if (pageId) switchPage(pageId);
                });
            });
            
            document.querySelectorAll('.tabs .tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabGroup = this.parentElement;
                    const tabId = this.getAttribute('data-tab');
                    tabGroup.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    const contentSection = this.closest('.page');
                    if (contentSection) {
                        contentSection.querySelectorAll('.tab-pane').forEach(pane => pane.classList.remove('active'));
                        const targetPane = contentSection.querySelector('#' + tabId);
                        if (targetPane) targetPane.classList.add('active');
                        if (contentSection.id === 'home-page') renderSchedule(tabId);
                    }
                });
            });
            
            const hamburger = document.querySelector('.hamburger');
            const navMenu = document.querySelector('.nav-menu');
            if (hamburger) {
                hamburger.addEventListener('click', function() {
                    navMenu.classList.toggle('active');
                    document.body.style.overflow = navMenu.classList.contains('active') ? 'hidden' : '';
                });
            }
            
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', function() {
                    if (window.innerWidth <= 768) {
                        navMenu.classList.remove('active');
                        document.body.style.overflow = '';
                    }
                });
            });
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        function openTeamModal(teamId = null) {
            const modal = document.getElementById('team-modal');
            const title = modal.querySelector('.modal-header h2');
            const form = document.getElementById('team-form');
            
            form.reset();
            
            if (teamId) {
                const team = getTeam(teamId);
                if (!team) return;
                title.textContent = '编辑战队';
                document.getElementById('team-id').value = team.id;
                document.getElementById('team-name').value = team.name || '';
                document.getElementById('team-logo').value = team.logo || '';
                document.getElementById('team-points').value = team.points || 0;
                document.getElementById('team-coach').value = team.coach || '';
            } else {
                title.textContent = '添加战队';
                document.getElementById('team-id').value = '';
            }
            
            modal.classList.add('active');
        }

        async function uploadToSupabaseStorage(file, bucket = 'images') {
            if (!CONFIG.supabaseClient) {
                alert('请先配置 Supabase 数据库连接');
                return null;
            }
            
            try {
                const fileName = `${Date.now()}_${file.name}`;
                const filePath = `${bucket}/${fileName}`;
                
                const { data, error } = await CONFIG.supabaseClient
                    .storage
                    .from(filePath)
                    .upload(file, {
                        cacheControl: '3600',
                        upsert: false
                    });
                
                if (error) throw error;
                
                const { data: { publicUrl } } = await CONFIG.supabaseClient
                    .storage
                    .from(filePath)
                    .createSignedUrl('', 60);
                
                return publicUrl;
            } catch (error) {
                console.error('上传失败:', error);
                alert('图片上传失败: ' + error.message);
                return null;
            }
        }

        function handleTeamLogoUpload(input) {
            const file = input.files[0];
            if (!file) return;
            
            const maxSize = 5 * 1024 * 1024;
            if (file.size > maxSize) {
                alert('图片大小不能超过 5MB');
                return;
            }
            
            const preview = document.getElementById('team-logo-img');
            preview.src = URL.createObjectURL(file);
            document.getElementById('team-logo-preview').style.display = 'block';
        }

        function handlePlayerImgUpload(input) {
            const file = input.files[0];
            if (!file) return;
            
            const maxSize = 5 * 1024 * 1024;
            if (file.size > maxSize) {
                alert('图片大小不能超过 5MB');
                return;
            }
            
            const preview = document.getElementById('player-img-img');
            preview.src = URL.createObjectURL(file);
            document.getElementById('player-img-preview').style.display = 'block';
        }

        async function saveTeam() {
            if (!CONFIG.supabaseClient) {
                alert('请先配置 Supabase 数据库连接');
                return;
            }
            
            const teamId = document.getElementById('team-id').value;
            const logoFileInput = document.getElementById('team-logo-file');
            
            let logoUrl = document.getElementById('team-logo').value.trim();
            
            // 如果选择了文件，上传到 Supabase Storage
            if (logoFileInput.files.length > 0) {
                const uploadedUrl = await uploadToSupabaseStorage(logoFileInput.files[0]);
                if (uploadedUrl) {
                    logoUrl = uploadedUrl;
                }
            }
            
            const teamData = {
                name: document.getElementById('team-name').value,
                logo: logoUrl,
                points: parseInt(document.getElementById('team-points').value) || 0,
                coach: document.getElementById('team-coach').value,
                updated_at: new Date().toISOString()
            };
            
            try {
                let result;
                if (teamId) {
                    result = await CONFIG.supabaseClient
                        .from('teams')
                        .update(teamData)
                        .eq('id', parseInt(teamId))
                        .select()
                        .single();
                } else {
                    result = await CONFIG.supabaseClient
                        .from('teams')
                        .insert([teamData])
                        .select()
                        .single();
                }
                
                if (result.error) throw result.error;
                
                closeModal('team-modal');
                await loadAllData();
                loadAdminPage();
                alert(teamId ? '战队更新成功！' : '战队添加成功！');
            } catch (error) {
                alert('保存失败: ' + error.message);
            }
        }

        async function deleteTeam(teamId) {
            if (!confirm('确定要删除这个战队吗？相关的选手数据也会被删除。')) return;
            
            if (!CONFIG.supabaseClient) {
                alert('请先配置 Supabase 数据库连接');
                return;
            }
            
            try {
                const result = await CONFIG.supabaseClient
                    .from('teams')
                    .delete()
                    .eq('id', teamId);
                
                if (result.error) throw result.error;
                
                await loadAllData();
                loadAdminPage();
                alert('战队删除成功！');
            } catch (error) {
                alert('删除失败: ' + error.message);
            }
        }

        function openPlayerModal(playerId = null) {
            const modal = document.getElementById('player-modal');
            const title = modal.querySelector('.modal-header h2');
            const form = document.getElementById('player-form');
            
            form.reset();
            
            const teamSelect = document.getElementById('player-team');
            teamSelect.innerHTML = '<option value="">选择战队</option>' + 
                appData.teams.map(t => `<option value="${t.id}">${t.name}</option>`).join('');
            
            if (playerId) {
                const player = getPlayer(playerId);
                if (!player) return;
                title.textContent = '编辑选手';
                document.getElementById('player-id').value = player.id;
                document.getElementById('player-name').value = player.name || '';
                document.getElementById('player-real-name').value = player.real_name || '';
                document.getElementById('player-team').value = player.team_id || '';
                document.getElementById('player-age').value = player.age || '';
                document.getElementById('player-country').value = player.country || '';
                document.getElementById('player-rating').value = player.rating || 1.00;
                document.getElementById('player-img').value = player.img || '';
            } else {
                title.textContent = '添加选手';
                document.getElementById('player-id').value = '';
            }
            
            modal.classList.add('active');
        }

        async function savePlayer() {
            if (!CONFIG.supabaseClient) {
                alert('请先配置 Supabase 数据库连接');
                return;
            }
            
            const playerId = document.getElementById('player-id').value;
            const imgFileInput = document.getElementById('player-img-file');
            
            let imgUrl = document.getElementById('player-img').value.trim();
            
            // 如果选择了文件，上传到 Supabase Storage
            if (imgFileInput.files.length > 0) {
                const uploadedUrl = await uploadToSupabaseStorage(imgFileInput.files[0]);
                if (uploadedUrl) {
                    imgUrl = uploadedUrl;
                }
            }
            
            const playerData = {
                name: document.getElementById('player-name').value,
                real_name: document.getElementById('player-real-name').value,
                team_id: document.getElementById('player-team').value ? parseInt(document.getElementById('player-team').value) : null,
                age: document.getElementById('player-age').value ? parseInt(document.getElementById('player-age').value) : null,
                country: document.getElementById('player-country').value,
                rating: parseFloat(document.getElementById('player-rating').value) || 1.00,
                img: imgUrl,
                updated_at: new Date().toISOString()
            };
            
            try {
                let result;
                if (playerId) {
                    result = await CONFIG.supabaseClient
                        .from('players')
                        .update(playerData)
                        .eq('id', parseInt(playerId))
                        .select()
                        .single();
                } else {
                    result = await CONFIG.supabaseClient
                        .from('players')
                        .insert([playerData])
                        .select()
                        .single();
                }
                
                if (result.error) throw result.error;
                
                closeModal('player-modal');
                await loadAllData();
                loadAdminPage();
                alert(playerId ? '选手更新成功！' : '选手添加成功！');
            } catch (error) {
                alert('保存失败: ' + error.message);
            }
        }

        async function deletePlayer(playerId) {
            if (!confirm('确定要删除这个选手吗？')) return;
            
            if (!CONFIG.supabaseClient) {
                alert('请先配置 Supabase 数据库连接');
                return;
            }
            
            try {
                const result = await CONFIG.supabaseClient
                    .from('players')
                    .delete()
                    .eq('id', playerId);
                
                if (result.error) throw result.error;
                
                await loadAllData();
                loadAdminPage();
                alert('选手删除成功！');
            } catch (error) {
                alert('删除失败: ' + error.message);
            }
        }

        function openMatchModal(matchId = null) {
            const modal = document.getElementById('match-modal');
            const title = modal.querySelector('.modal-header h2');
            const form = document.getElementById('match-form');
            
            form.reset();
            
            const team1Select = document.getElementById('match-team1');
            const team2Select = document.getElementById('match-team2');
            team1Select.innerHTML = '<option value="">选择战队</option>' + 
                appData.teams.map(t => `<option value="${t.id}">${t.name}</option>`).join('');
            team2Select.innerHTML = '<option value="">选择战队</option>' + 
                appData.teams.map(t => `<option value="${t.id}">${t.name}</option>`).join('');
            
            if (matchId) {
                const match = getMatch(matchId);
                if (!match) return;
                title.textContent = '编辑比赛';
                document.getElementById('match-id').value = match.id;
                document.getElementById('match-tournament').value = match.tournament || '';
                document.getElementById('match-team1').value = match.team1_id || '';
                document.getElementById('match-team2').value = match.team2_id || '';
                document.getElementById('match-date').value = match.date || '';
                document.getElementById('match-time').value = match.time || '';
                document.getElementById('match-type').value = match.type || 'today';
                window.currentMatchMaps = match.maps || [];
            } else {
                title.textContent = '添加比赛';
                document.getElementById('match-id').value = '';
                window.currentMatchMaps = [];
            }
            
            renderMaps();
            modal.classList.add('active');
        }

        function renderMaps() {
            const container = document.getElementById('maps-container');
            const maps = window.currentMatchMaps || [];
            
            if (maps.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: var(--gray-color); background: #f8f9fa; border-radius: 8px;">
                        <i class="fas fa-map" style="font-size: 2rem; margin-bottom: 10px; opacity: 0.5;"></i>
                        <p>暂无地图，点击上方按钮添加地图</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = maps.map((map, index) => {
                const team1Id = parseInt(document.getElementById('match-team1')?.value) || 0;
                const team2Id = parseInt(document.getElementById('match-team2')?.value) || 0;
                const team1Players = appData.players.filter(p => p.team_id === team1Id);
                const team2Players = appData.players.filter(p => p.team_id === team2Id);
                
                const team1Stats = map.stats?.team1 || {};
                const team2Stats = map.stats?.team2 || {};
                
                return `
                    <div class="card map-card" style="background: #f8f9fa; border: 2px solid var(--light-color);" data-map-index="${index}">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <h5 style="margin: 0; display: flex; align-items: center; gap: 10px;">
                                <i class="fas fa-crosshairs" style="color: var(--primary-color);"></i>
                                <span>地图 ${index + 1}</span>
                            </h5>
                            <button type="button" class="btn btn-danger btn-sm" onclick="removeMap(${index})">
                                <i class="fas fa-trash"></i> 删除
                            </button>
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div class="form-group" style="margin-bottom: 0;">
                                <label>地图名称</label>
                                <input type="text" class="form-control map-name" value="${map.name || ''}" placeholder="如: Inferno">
                            </div>
                            <div class="form-group" style="margin-bottom: 0;">
                                <label>战队1得分</label>
                                <input type="number" class="form-control map-score1" value="${map.score1 !== undefined ? map.score1 : ''}" placeholder="0">
                            </div>
                            <div class="form-group" style="margin-bottom: 0;">
                                <label>战队2得分</label>
                                <input type="number" class="form-control map-score2" value="${map.score2 !== undefined ? map.score2 : ''}" placeholder="0">
                            </div>
                        </div>
                        
                        ${team1Players.length > 0 || team2Players.length > 0 ? `
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 15px;">
                            <div>
                                <h6 style="color: var(--primary-color); margin-bottom: 10px;">
                                    <i class="fas fa-users"></i> 战队1选手数据
                                </h6>
                                <div style="background: #fff; padding: 10px; border-radius: 8px; max-height: 300px; overflow-y: auto;">
                                    ${team1Players.length === 0 ? '<p style="color: var(--gray-color); font-size: 0.9rem;">暂无选手</p>' : `
                                        <table style="width: 100%; font-size: 0.85rem; border-collapse: collapse;">
                                            <thead>
                                                <tr style="color: #888;">
                                                    <th style="padding: 8px; text-align: left;">选手</th>
                                                    <th style="padding: 8px; text-align: center;">K</th>
                                                    <th style="padding: 8px; text-align: center;">D</th>
                                                    <th style="padding: 8px; text-align: center;">A</th>
                                                    <th style="padding: 8px; text-align: center;">ADR</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                ${team1Players.map(p => `
                                                    <tr>
                                                        <td style="padding: 8px;">${p.name}</td>
                                                        <td style="padding: 8px; text-align: center;">
                                                            <input type="number" class="player-stat-k" data-player="${p.id}" data-team="1" value="${team1Stats[p.id]?.kill || 0}" style="width: 50px; padding: 4px; border: 1px solid #ddd; border-radius: 4px; text-align: center;">
                                                        </td>
                                                        <td style="padding: 8px; text-align: center;">
                                                            <input type="number" class="player-stat-d" data-player="${p.id}" data-team="1" value="${team1Stats[p.id]?.death || 0}" style="width: 50px; padding: 4px; border: 1px solid #ddd; border-radius: 4px; text-align: center;">
                                                        </td>
                                                        <td style="padding: 8px; text-align: center;">
                                                            <input type="number" class="player-stat-a" data-player="${p.id}" data-team="1" value="${team1Stats[p.id]?.swing || 0}" style="width: 50px; padding: 4px; border: 1px solid #ddd; border-radius: 4px; text-align: center;">
                                                        </td>
                                                        <td style="padding: 8px; text-align: center;">
                                                            <input type="number" class="player-stat-adr" data-player="${p.id}" data-team="1" value="${team1Stats[p.id]?.adr?.toFixed(1) || 0}" style="width: 60px; padding: 4px; border: 1px solid #ddd; border-radius: 4px; text-align: center;" step="0.1">
                                                        </td>
                                                    </tr>
                                                `).join('')}
                                            </tbody>
                                        </table>
                                    `}
                                </div>
                            </div>
                            <div>
                                <h6 style="color: var(--secondary-color); margin-bottom: 10px;">
                                    <i class="fas fa-users"></i> 战队2选手数据
                                </h6>
                                <div style="background: #fff; padding: 10px; border-radius: 8px; max-height: 300px; overflow-y: auto;">
                                    ${team2Players.length === 0 ? '<p style="color: var(--gray-color); font-size: 0.9rem;">暂无选手</p>' : `
                                        <table style="width: 100%; font-size: 0.85rem; border-collapse: collapse;">
                                            <thead>
                                                <tr style="color: #888;">
                                                    <th style="padding: 8px; text-align: left;">选手</th>
                                                    <th style="padding: 8px; text-align: center;">K</th>
                                                    <th style="padding: 8px; text-align: center;">D</th>
                                                    <th style="padding: 8px; text-align: center;">A</th>
                                                    <th style="padding: 8px; text-align: center;">ADR</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                ${team2Players.map(p => `
                                                    <tr>
                                                        <td style="padding: 8px;">${p.name}</td>
                                                        <td style="padding: 8px; text-align: center;">
                                                            <input type="number" class="player-stat-k" data-player="${p.id}" data-team="2" value="${team2Stats[p.id]?.kill || 0}" style="width: 50px; padding: 4px; border: 1px solid #ddd; border-radius: 4px; text-align: center;">
                                                        </td>
                                                        <td style="padding: 8px; text-align: center;">
                                                            <input type="number" class="player-stat-d" data-player="${p.id}" data-team="2" value="${team2Stats[p.id]?.death || 0}" style="width: 50px; padding: 4px; border: 1px solid #ddd; border-radius: 4px; text-align: center;">
                                                        </td>
                                                        <td style="padding: 8px; text-align: center;">
                                                            <input type="number" class="player-stat-a" data-player="${p.id}" data-team="2" value="${team2Stats[p.id]?.swing || 0}" style="width: 50px; padding: 4px; border: 1px solid #ddd; border-radius: 4px; text-align: center;">
                                                        </td>
                                                        <td style="padding: 8px; text-align: center;">
                                                            <input type="number" class="player-stat-adr" data-player="${p.id}" data-team="2" value="${team2Stats[p.id]?.adr?.toFixed(1) || 0}" style="width: 60px; padding: 4px; border: 1px solid #ddd; border-radius: 4px; text-align: center;" step="0.1">
                                                        </td>
                                                    </tr>
                                                `).join('')}
                                            </tbody>
                                        </table>
                                    `}
                                </div>
                            </div>
                        </div>
                        ` : ''}
                    </div>
                `;
            }).join('');
        }

        function addMap() {
            const newMap = {
                name: '',
                score1: null,
                score2: null,
                stats: { team1: {}, team2: {} }
            };
            window.currentMatchMaps.push(newMap);
            renderMaps();
        }

        function removeMap(index) {
            if (!confirm('确定要删除这张地图吗？')) return;
            window.currentMatchMaps.splice(index, 1);
            renderMaps();
        }

        async function saveMatch() {
            if (!CONFIG.supabaseClient) {
                alert('请先配置 Supabase 数据库连接');
                return;
            }
            
            const matchId = document.getElementById('match-id').value;
            
            const maps = [];
            document.querySelectorAll('.map-card').forEach((card, index) => {
                const mapName = card.querySelector('.map-name')?.value || '';
                const score1 = card.querySelector('.map-score1')?.value ? parseInt(card.querySelector('.map-score1').value) : null;
                const score2 = card.querySelector('.map-score2')?.value ? parseInt(card.querySelector('.map-score2').value) : null;
                
                const team1Stats = {};
                const team2Stats = {};
                
                card.querySelectorAll('.player-stat-k').forEach(input => {
                    const playerId = parseInt(input.dataset.player);
                    const team = input.dataset.team;
                    const kill = parseInt(input.value) || 0;
                    const death = parseInt(input.closest('tr').querySelector('.player-stat-d')?.value) || 0;
                    const swing = parseInt(input.closest('tr').querySelector('.player-stat-a')?.value) || 0;
                    const adr = parseFloat(input.closest('tr').querySelector('.player-stat-adr')?.value) || 0;
                    
                    if (team === '1') {
                        team1Stats[playerId] = { kill, death, swing, adr };
                    } else {
                        team2Stats[playerId] = { kill, death, swing, adr };
                    }
                });
                
                maps.push({
                    name: mapName,
                    score1,
                    score2,
                    stats: { team1: team1Stats, team2: team2Stats }
                });
            });
            
            const matchData = {
                tournament: document.getElementById('match-tournament').value,
                team1_id: document.getElementById('match-team1').value ? parseInt(document.getElementById('match-team1').value) : null,
                team2_id: document.getElementById('match-team2').value ? parseInt(document.getElementById('match-team2').value) : null,
                date: document.getElementById('match-date').value,
                time: document.getElementById('match-time').value,
                type: document.getElementById('match-type').value,
                maps,
                updated_at: new Date().toISOString()
            };
            
            try {
                let result;
                if (matchId) {
                    result = await CONFIG.supabaseClient
                        .from('matches')
                        .update(matchData)
                        .eq('id', parseInt(matchId))
                        .select()
                        .single();
                } else {
                    result = await CONFIG.supabaseClient
                        .from('matches')
                        .insert([matchData])
                        .select()
                        .single();
                }
                
                if (result.error) throw result.error;
                
                closeModal('match-modal');
                await loadAllData();
                loadAdminPage();
                alert(matchId ? '比赛更新成功！' : '比赛添加成功！');
            } catch (error) {
                alert('保存失败: ' + error.message);
            }
        }

        async function deleteMatch(matchId) {
            if (!confirm('确定要删除这场比赛吗？')) return;
            
            if (!CONFIG.supabaseClient) {
                alert('请先配置 Supabase 数据库连接');
                return;
            }
            
            try {
                const result = await CONFIG.supabaseClient
                    .from('matches')
                    .delete()
                    .eq('id', matchId);
                
                if (result.error) throw result.error;
                
                await loadAllData();
                loadAdminPage();
                alert('比赛删除成功！');
            } catch (error) {
                alert('删除失败: ' + error.message);
            }
        }

        function initApp() {
            try {
                loadConfig();
                initEventListeners();
                switchPage('home');
            } catch (error) {
                console.error('应用初始化失败:', error);
            }
        }

        document.addEventListener('DOMContentLoaded', initApp);
    </script>
    
    <div id="team-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>添加战队</h2>
                <button class="modal-close" onclick="closeModal('team-modal')">&times;</button>
            </div>
            <form id="team-form" onsubmit="event.preventDefault(); saveTeam();">
                <div class="modal-body">
                    <input type="hidden" id="team-id">
                    <div class="form-group">
                        <label>战队名称</label>
                        <input type="text" id="team-name" class="form-control" placeholder="请输入战队名称" required>
                    </div>
                    <div class="form-group">
                        <label>战队Logo</label>
                        <div style="display: flex; gap: 15px; align-items: center;">
                            <input type="text" id="team-logo" class="form-control" placeholder="或上传图片" style="flex: 1;">
                            <div style="position: relative;">
                                <input type="file" id="team-logo-file" accept="image/*" onchange="handleTeamLogoUpload(this)" style="display: none;">
                                <button type="button" class="btn btn-secondary" onclick="document.getElementById('team-logo-file').click()">
                                    <i class="fas fa-upload"></i> 上传图片
                                </button>
                            </div>
                        </div>
                        <div id="team-logo-preview" style="display: none; margin-top: 10px; text-align: center;">
                            <img id="team-logo-img" style="max-width: 200px; max-height: 200px; border-radius: 8px; border: 2px solid var(--light-color);">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>积分</label>
                        <input type="number" id="team-points" class="form-control" placeholder="积分" value="0">
                    </div>
                    <div class="form-group">
                        <label>教练</label>
                        <input type="text" id="team-coach" class="form-control" placeholder="教练名称">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('team-modal')">取消</button>
                    <button type="submit" class="btn btn-primary">保存</button>
                </div>
            </form>
        </div>
    </div>

    <div id="player-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>添加选手</h2>
                <button class="modal-close" onclick="closeModal('player-modal')">&times;</button>
            </div>
            <form id="player-form" onsubmit="event.preventDefault(); savePlayer();">
                <div class="modal-body">
                    <input type="hidden" id="player-id">
                    <div class="form-group">
                        <label>选手名称</label>
                        <input type="text" id="player-name" class="form-control" placeholder="选手游戏ID" required>
                    </div>
                    <div class="form-group">
                        <label>真实姓名</label>
                        <input type="text" id="player-real-name" class="form-control" placeholder="真实姓名">
                    </div>
                    <div class="form-group">
                        <label>所属战队</label>
                        <select id="player-team" class="form-control">
                            <option value="">选择战队</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>年龄</label>
                        <input type="number" id="player-age" class="form-control" placeholder="年龄">
                    </div>
                    <div class="form-group">
                        <label>国籍</label>
                        <input type="text" id="player-country" class="form-control" placeholder="国家/地区">
                    </div>
                    <div class="form-group">
                        <label>Rating</label>
                        <input type="number" id="player-rating" class="form-control" placeholder="Rating" step="0.01" value="1.00">
                    </div>
                    <div class="form-group">
                        <label>头像</label>
                        <div style="display: flex; gap: 15px; align-items: center;">
                            <input type="text" id="player-img" class="form-control" placeholder="或上传图片" style="flex: 1;">
                            <div style="position: relative;">
                                <input type="file" id="player-img-file" accept="image/*" onchange="handlePlayerImgUpload(this)" style="display: none;">
                                <button type="button" class="btn btn-secondary" onclick="document.getElementById('player-img-file').click()">
                                    <i class="fas fa-upload"></i> 上传图片
                                </button>
                            </div>
                        </div>
                        <div id="player-img-preview" style="display: none; margin-top: 10px; text-align: center;">
                            <img id="player-img-img" style="max-width: 200px; max-height: 200px; border-radius: 8px; border: 2px solid var(--light-color);">
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('player-modal')">取消</button>
                    <button type="submit" class="btn btn-primary">保存</button>
                </div>
            </form>
        </div>
    </div>

    <div id="match-modal" class="modal" style="z-index: 3000;">
        <div class="modal-content" style="max-width: 1400px; max-height: 95vh;">
            <div class="modal-header">
                <h2>添加比赛</h2>
                <button class="modal-close" onclick="closeModal('match-modal')">&times;</button>
            </div>
            <form id="match-form" onsubmit="event.preventDefault(); saveMatch();">
                <div class="modal-body" style="max-height: calc(95vh - 150px); overflow-y: auto;">
                    <input type="hidden" id="match-id">
                    <div class="form-group">
                        <label>赛事名称</label>
                        <input type="text" id="match-tournament" class="form-control" placeholder="赛事名称" required>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div class="form-group">
                            <label>战队1</label>
                            <select id="match-team1" class="form-control">
                                <option value="">选择战队</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>战队2</label>
                            <select id="match-team2" class="form-control">
                                <option value="">选择战队</option>
                            </select>
                        </div>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div class="form-group">
                            <label>日期</label>
                            <input type="date" id="match-date" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label>时间</label>
                            <input type="time" id="match-time" class="form-control">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>类型</label>
                        <select id="match-type" class="form-control">
                            <option value="today">今日比赛</option>
                            <option value="upcoming">未来赛事</option>
                            <option value="past">过往比赛</option>
                        </select>
                    </div>
                    
                    <hr style="margin: 25px 0; border-color: var(--light-color);">
                    
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h4 style="margin: 0;"><i class="fas fa-map"></i> 地图管理</h4>
                        <button type="button" class="btn btn-primary btn-sm" onclick="addMap()">
                            <i class="fas fa-plus"></i> 添加地图
                        </button>
                    </div>
                    
                    <div id="maps-container"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('match-modal')">取消</button>
                    <button type="submit" class="btn btn-primary">保存</button>
                </div>
            </form>
        </div>
    </div>
</body>
</html>
